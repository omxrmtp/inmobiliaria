<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DelgadoPropiedades - Encuentra el hogar de tus sue√±os</title>
    <!-- Fuentes de Google -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Estilos CSS -->
    <link rel="shortcut icon" href="images/propiedad.png" type="image/png">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/home.css">
    <link rel="stylesheet" href="css/testimonios.css">
    <style>
      /* Scoped styles for Lead WhatsApp Form - MEJORADO */
      #lead-whatsapp { 
        padding: 40px 0 60px 0; 
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      }
      #lead-whatsapp .lwf-container { 
        max-width: 900px; 
        margin: 0 auto; 
        padding: 0 16px; 
      }
      #lead-whatsapp .lwf-card { 
        background: #ffffff; 
        border: none;
        border-radius: 20px; 
        box-shadow: 0 10px 40px rgba(0,0,0,0.08); 
        overflow: hidden;
        transition: box-shadow 0.3s ease;
      }
      #lead-whatsapp .lwf-card:hover {
        box-shadow: 0 15px 50px rgba(0,0,0,0.12);
      }
      #lead-whatsapp .lwf-header { 
        padding: 32px 28px 24px 28px;
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        color: white;
      }
      #lead-whatsapp .lwf-title { 
        margin: 0 0 8px 0; 
        font-size: 28px; 
        font-weight: 800; 
        letter-spacing: -0.5px;
        color: white;
      }
      #lead-whatsapp .lwf-subtitle { 
        margin: 0; 
        color: #cbd5e1; 
        font-size: 14px;
        font-weight: 400;
      }
      #lead-whatsapp .lwf-body { 
        padding: 32px 28px; 
      }
      #lead-whatsapp .lwf-grid { 
        display: grid; 
        grid-template-columns: repeat(2, minmax(0, 1fr)); 
        gap: 20px; 
      }
      #lead-whatsapp .lwf-col-span-2 { 
        grid-column: span 2; 
      }
      #lead-whatsapp .lwf-field { 
        display: flex; 
        flex-direction: column; 
      }
      #lead-whatsapp .lwf-label { 
        font-size: 13px; 
        font-weight: 700; 
        color: #1e293b; 
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      #lead-whatsapp .lwf-input, 
      #lead-whatsapp .lwf-select, 
      #lead-whatsapp .lwf-textarea { 
        border: 2px solid #e2e8f0; 
        border-radius: 12px; 
        padding: 14px 16px; 
        font-size: 15px; 
        outline: none; 
        background: #f8fafc;
        font-family: inherit;
        transition: all 0.3s ease;
      }
      #lead-whatsapp .lwf-input::placeholder,
      #lead-whatsapp .lwf-select::placeholder,
      #lead-whatsapp .lwf-textarea::placeholder {
        color: #94a3b8;
      }
      #lead-whatsapp .lwf-textarea { 
        min-height: 110px; 
        resize: vertical;
      }
      #lead-whatsapp .lwf-input:focus, 
      #lead-whatsapp .lwf-select:focus, 
      #lead-whatsapp .lwf-textarea:focus { 
        border-color: #FCBA00;
        background: #ffffff;
        box-shadow: 0 0 0 4px rgba(252, 186, 0, 0.1);
      }
      #lead-whatsapp .lwf-input.success,
      #lead-whatsapp .lwf-select.success,
      #lead-whatsapp .lwf-textarea.success {
        border-color: #10b981;
        background: #f0fdf4;
      }
      #lead-whatsapp .lwf-input.error,
      #lead-whatsapp .lwf-select.error,
      #lead-whatsapp .lwf-textarea.error {
        border-color: #ef4444;
        background: #fef2f2;
      }
      #lead-whatsapp .lwf-help { 
        font-size: 12px; 
        color: #94a3b8; 
        margin-top: 6px;
        font-style: italic;
      }
      #lead-whatsapp .lwf-error {
        font-size: 12px;
        color: #ef4444;
        margin-top: 6px;
        font-weight: 500;
      }
      #lead-whatsapp .lwf-radios { 
        display: flex; 
        flex-wrap: wrap; 
        gap: 12px;
      }
      #lead-whatsapp .lwf-radio { 
        display: inline-flex; 
        align-items: center; 
        gap: 8px; 
        border: 2px solid #e2e8f0; 
        border-radius: 10px; 
        padding: 10px 14px; 
        font-size: 14px; 
        cursor: pointer; 
        background: #f8fafc;
        transition: all 0.2s ease;
        font-weight: 500;
      }
      #lead-whatsapp .lwf-radio:hover {
        border-color: #FCBA00;
        background: #fffbeb;
      }
      #lead-whatsapp .lwf-radio input { 
        appearance: none; 
        width: 16px; 
        height: 16px; 
        border: 2px solid #cbd5e1; 
        border-radius: 50%; 
        display: inline-block; 
        position: relative;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      #lead-whatsapp .lwf-radio input:checked { 
        border-color: #FCBA00;
        background: #FCBA00;
      }
      #lead-whatsapp .lwf-radio input:checked::after { 
        content: "‚úì"; 
        position: absolute; 
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 11px;
        font-weight: bold;
      }
      #lead-whatsapp .lwf-actions { 
        display: flex; 
        justify-content: center;
        gap: 12px;
        padding: 0;
        margin-top: 24px;
      }
      #lead-whatsapp .lwf-note { 
        font-size: 12px; 
        color: #64748b; 
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e2e8f0;
        text-align: center;
      }
      #lead-whatsapp .btn {
        padding: 14px 32px;
        font-size: 15px;
        font-weight: 700;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      #lead-whatsapp .btn-primary {
        background: linear-gradient(135deg, #FCBA00 0%, #E5A200 100%);
        color: #1e293b;
        flex: 1;
        max-width: 300px;
      }
      #lead-whatsapp .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(252, 186, 0, 0.3);
      }
      #lead-whatsapp .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      @media (max-width: 768px) {
        #lead-whatsapp { 
          padding: 30px 0 50px 0;
        }
        #lead-whatsapp .lwf-header {
          padding: 24px 20px 18px 20px;
        }
        #lead-whatsapp .lwf-title {
          font-size: 24px;
        }
        #lead-whatsapp .lwf-body {
          padding: 24px 20px;
        }
        #lead-whatsapp .lwf-grid { 
          grid-template-columns: 1fr; 
          gap: 16px;
        }
        #lead-whatsapp .lwf-col-span-2 { 
          grid-column: span 1; 
        }
        #lead-whatsapp .lwf-input,
        #lead-whatsapp .lwf-select,
        #lead-whatsapp .lwf-textarea {
          font-size: 16px;
          padding: 12px 14px;
        }
        #lead-whatsapp .lwf-radios {
          gap: 8px;
        }
        #lead-whatsapp .lwf-radio {
          padding: 8px 12px;
          font-size: 13px;
        }
        #lead-whatsapp .lwf-actions {
          flex-direction: column;
        }
        #lead-whatsapp .btn {
          width: 100%;
          max-width: none;
        }
      }
    </style>
    <script src="config.js"></script>
    <script src="crm-config.js"></script>
    <script>
      // Detectar si estamos en desarrollo o producci√≥n
      const isDevelopment = window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1' ||
                           window.location.hostname.includes('192.168');
      
      window.CRM_API_BASE = window.CRM_API_BASE || '/public';
    </script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <a href="index.html" class="logo">
                    <img src="logo/propiedadedelgado.png" alt="TechoPropio Logo" class="header-image">
                </a>
            </div>
            
            <nav class="nav">
                <ul class="nav-list">
                    <li class="nav-item"><a href="index.html" class="nav-link active">Inicio</a></li>
                    <li class="nav-item"><a href="proyectos.html" class="nav-link">Proyectos</a></li>
                    <li class="nav-item nav-dropdown">
                        <a href="javascript:void(0)" class="nav-link nav-dropdown-toggle">
                            Nosotros <i class="fas fa-chevron-down"></i>
                        </a>
                        <div class="nav-dropdown-content">
                            <a href="team.html" class="nav-dropdown-item">Equipo</a>
                            <a href="otros-servicios.php" class="nav-dropdown-item">Otros Servicios</a>
                        </div>
                    </li>
                    <li class="nav-item"><a href="contact.html" class="nav-link">Contacto</a></li>
                </ul>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <a href="client-login.php" class="btn-login">
                        <i class="fas fa-user"></i> Portal Cliente
                    </a>
                </div>
            </nav>
            
            <div class="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <br>
        <div class="hero-slider">
                
            <div class="slide active" style="background-image: url('img/fondo.jpg');"></div>

        </div>
        <div class="hero-overlay"></div>
        <div class="container">
             <div class="hero-buttons slide-in-up">
                <a href="properties.html" class="btn btn-primary">Ver Propiedades</a>
                <a href="techo-propio.html" class="btn btn-outline">Programa Techo Propio</a>
                <a href="credito.html" class="btn btn-outline">Cr√©dito MiVivienda</a>
            </div>
        </div>
    </section>

    <!-- Lead para CRM con Toast Notifications -->
    <section id="lead-whatsapp" aria-labelledby="lead-whatsapp-title">
      <div class="lwf-container">
        <div class="lwf-card">
          <div class="lwf-header">
            <h2 id="lead-whatsapp-title" class="lwf-title">Cont√°ctanos</h2>
            <p class="lwf-subtitle">Completa tus datos y al enviar el asesor se contactar√° contigo.</p>
          </div>
          <div class="lwf-body">
            <!-- Toast Container -->
            <div id="lwf-toast-container" style="position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; max-width: 400px;"></div>

            <form id="lwf-form" novalidate>
              <div class="lwf-grid">
                <div class="lwf-field">
                  <label class="lwf-label" for="lwf-nombre">Nombre *</label>
                  <input class="lwf-input" type="text" id="lwf-nombre" name="nombre" placeholder="Solo letras y espacios" required>
                  <div class="lwf-error" id="lwf-nombre-error"></div>
                </div>
                <div class="lwf-field">
                  <label class="lwf-label" for="lwf-apellido">Apellido *</label>
                  <input class="lwf-input" type="text" id="lwf-apellido" name="apellido" placeholder="Solo letras y espacios" required>
                  <div class="lwf-error" id="lwf-apellido-error"></div>
                </div>
                <div class="lwf-field">
                  <label class="lwf-label" for="lwf-email">Email *</label>
                  <input class="lwf-input" type="email" id="lwf-email" name="email" placeholder="ejemplo@correo.com" required>
                  <div class="lwf-error" id="lwf-email-error"></div>
                </div>
                <div class="lwf-field">
                  <label class="lwf-label" for="lwf-telefono">Tel√©fono *</label>
                  <input class="lwf-input" type="tel" id="lwf-telefono" name="telefono" placeholder="999 999 999" maxlength="9" required>
                  <div class="lwf-error" id="lwf-telefono-error"></div>
                </div>

                <div class="lwf-field lwf-col-span-2">
                  <span class="lwf-label">Inter√©s *</span>
                  <div class="lwf-radios">
                    <label class="lwf-radio"><input type="radio" name="interes" value="Techo Propio" required>Techo Propio</label>
                    <label class="lwf-radio"><input type="radio" name="interes" value="MiVivienda" required>Cr√©dito MiVivienda</label>
                    <label class="lwf-radio"><input type="radio" name="interes" value="Comprar" required>Comprar</label>
                    <label class="lwf-radio"><input type="radio" name="interes" value="Vender" required>Vender</label>
                    <label class="lwf-radio"><input type="radio" name="interes" value="Alquilar" required>Alquilar</label>
                    <label class="lwf-radio"><input type="radio" name="interes" value="Construccion" required>Construcci√≥n</label>
                  </div>
                  <div class="lwf-error" id="lwf-interes-error"></div>
                </div>

                <div class="lwf-field">
                  <label class="lwf-label" for="lwf-origen">¬øC√≥mo nos conociste?</label>
                  <select class="lwf-select" id="lwf-origen" name="origen">
                    <option value="">Selecciona</option>
                    <option value="TikTok">TikTok</option>
                    <option value="YouTube">YouTube</option>
                    <option value="Instagram">Instagram</option>
                    <option value="Facebook">Facebook</option>
                    <option value="Recomendaci√≥n">Recomendaci√≥n</option>
                  </select>
                  <div class="lwf-help">Opcional</div>
                </div>

                <div class="lwf-field">
                  <label class="lwf-label" for="lwf-mensaje">Mensaje</label>
                  <textarea class="lwf-textarea" id="lwf-mensaje" name="mensaje" placeholder="Cu√©ntanos brevemente tu consulta"></textarea>
                  <div class="lwf-help">Opcional</div>
                </div>
              </div>
              <div class="lwf-actions">
                <button type="submit" class="btn btn-primary" id="lwf-submit-btn">Contactar</button>
              </div>
              <div class="lwf-note">Tus datos se guardar√°n en nuestro sistema y te contactaremos pronto. Tambi√©n recibir√°s un mensaje por WhatsApp.</div>
            </form>
          </div>
        </div>
      </div>
    </section>

    <style>
      /* Toast Styles */
      .lwf-toast {
        padding: 16px 20px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        display: flex;
        align-items: flex-start;
        gap: 12px;
        animation: slideInRight 0.3s ease-out;
        min-width: 300px;
      }

      @keyframes slideInRight {
        from {
          transform: translateX(400px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOutRight {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(400px);
          opacity: 0;
        }
      }

      .lwf-toast.removing {
        animation: slideOutRight 0.3s ease-out;
      }

      .lwf-toast-success {
        background: #ecfdf5;
        border: 1px solid #d1fae5;
        color: #065f46;
      }

      .lwf-toast-error {
        background: #fef2f2;
        border: 1px solid #fee2e2;
        color: #991b1b;
      }

      .lwf-toast-info {
        background: #eff6ff;
        border: 1px solid #bfdbfe;
        color: #1e3a8a;
      }

      .lwf-toast-warning {
        background: #fffbeb;
        border: 1px solid #fcd34d;
        color: #78350f;
      }

      .lwf-toast-icon {
        font-size: 20px;
        flex-shrink: 0;
        line-height: 1;
      }

      .lwf-toast-content {
        flex: 1;
        font-size: 14px;
        line-height: 1.5;
      }

      .lwf-toast-close {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 18px;
        padding: 0;
        flex-shrink: 0;
        opacity: 0.6;
        transition: opacity 0.2s;
      }

      .lwf-toast-close:hover {
        opacity: 1;
      }

      /* Error Messages */
      .lwf-error {
        font-size: 12px;
        color: #dc2626;
        margin-top: 4px;
        min-height: 16px;
      }

      /* Input error state */
      .lwf-input.error,
      .lwf-select.error,
      .lwf-textarea.error {
        border-color: #fca5a5;
        background-color: #fef2f2;
      }

      .lwf-input.success,
      .lwf-select.success,
      .lwf-textarea.success {
        border-color: #86efac;
        background-color: #f0fdf4;
      }

      /* Loading spinner */
      .lwf-spinner {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid rgba(0,0,0,0.1);
        border-top-color: currentColor;
        border-radius: 50%;
        animation: spin 0.6s linear infinite;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      .lwf-submit-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
    </style>

    <!-- Services Section -->
    <section class="features">
        <div class="container">
            <div class="section-title">
                <h2>Nuestros Servicios</h2>
                <p>Soluciones inmobiliarias adaptadas a tus necesidades</p>
            </div>
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <h3 class="feature-title">Propiedades</h3>
                    <p class="feature-description">Amplia variedad de casas, departamentos, terrenos y locales comerciales en las mejores ubicaciones.</p>
                    <a href="properties.html" class="btn btn-sm">Ver propiedades</a>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h3 class="feature-title">Asesoramiento</h3>
                    <p class="feature-description">Nuestros asesores te guiar√°n en todo el proceso de compra o venta seg√∫n tus necesidades y presupuesto.</p>
                    <a href="contact.html" class="btn btn-sm">Contactar asesor</a>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3 class="feature-title">Techo Propio</h3>
                    <p class="feature-description">Te ayudamos a acceder al programa Techo Propio y cumplir el sue√±o de tener tu casa propia.</p>
                    <a href="techo-propio.html" class="btn btn-sm">M√°s informaci√≥n</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Testimonios Section -->
    <section class="testimonios-section">
        <div class="container">
            <div class="section-title">
                <h2>Lo que dicen nuestros clientes</h2>
                <p>Testimonios de clientes satisfechos con nuestro servicio</p>
            </div>
            <div class="testimonios-carousel">
                <div class="carousel-container">
                    <div class="testimonios-track" id="testimonios-track">
                        <!-- Los testimonios se cargar√°n aqu√≠ din√°micamente -->
                    </div>
                    <button class="carousel-btn prev" id="prev-btn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="carousel-btn next" id="next-btn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="carousel-dots" id="carousel-dots">
                    <!-- Los puntos se generar√°n din√°micamente -->
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-top">
                <div class="footer-info">
                    <div class="footer-logo">
                        <i class="fas fa-building footer-logo-icon"></i>
                        <h3>DelgadoPropiedades</h3>
                    </div>
                    <p class="footer-description">
                        Ofrecemos las mejores propiedades con asesoramiento personalizado para que encuentres el hogar de tus sue√±os.
                    </p>
                    <div class="social-links">
                        <a href="https://web.facebook.com/MDelgadoPropiedades" class="social-link"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://www.instagram.com/delgado.propiedades" class="social-link"><i class="fab fa-instagram"></i></a>
                        <a href="https://www.tiktok.com/@delgado_propiedades" class="social-link"><i class="fab fa-tiktok"></i></a>
                        <a href="https://wa.me/51948734448" class="social-link"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                
   
                
                <div class="footer-links-container">
                    <h4 class="footer-title">Servicios</h4>
                    <ul class="footer-links">
                        <li><a href="properties.html"><i class="fas fa-chevron-right"></i> Compra de propiedades</a></li>
                        <li><a href="properties.html"><i class="fas fa-chevron-right"></i> Venta de propiedades</a></li>
                        <li><a href="credito.html"><i class="fas fa-chevron-right"></i> Credito MiVivienda</a></li>
                        <li><a href="techo-propio.html"><i class="fas fa-chevron-right"></i> Programa Techo Propio</a></li>
                    </ul>
                </div>
                
                <div class="footer-contact">
                    <h4 class="footer-title">Cont√°ctanos</h4>
                    <ul class="footer-contact-list">
                      <li>
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Mariscal Nieto 480, Centro Comercial Boulevard Interior C1-C2 Segundo Piso</span>
                      </li>
                      <li>
                        <i class="fas fa-phone"></i>
                        <span>+51 948 734 448</span>
                      </li>
                      <li>
                        <i class="fas fa-envelope"></i>
                        <span>inmobiliaria.dpropiedades@gmail.com</span>
                      </li>
                      <li>
                        <i class="fas fa-clock"></i>
                        <span>Lun - Sab: 9 AM - 5 PM</span>
                      </li>
                    </ul>
                  </div>
                </div>
            
            <div class="footer-bottom">
                <p>&copy; <span id="current-year"></span> DelgadoPropiedades. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>


    <!-- Inline JS for Lead WhatsApp Form - MEJORADO -->
    <script>
      (function() {
        // ============ UTILIDADES DE TOAST ==============
        var toastContainer = document.getElementById('lwf-toast-container');

        function showToast(message, type = 'info', duration = 5000) {
          var icons = {
            success: '‚úì',
            error: '‚úï',
            warning: '‚ö†',
            info: '‚Ñπ'
          };

          var toast = document.createElement('div');
          toast.className = 'lwf-toast lwf-toast-' + type;
          toast.innerHTML = `
            <span class="lwf-toast-icon">${icons[type] || icons['info']}</span>
            <div class="lwf-toast-content">${message}</div>
            <button class="lwf-toast-close" type="button" aria-label="Cerrar notificaci√≥n">√ó</button>
          `;

          toastContainer.appendChild(toast);

          var closeBtn = toast.querySelector('.lwf-toast-close');
          closeBtn.onclick = function() {
            removeToast(toast);
          };

          if (duration > 0) {
            setTimeout(function() {
              removeToast(toast);
            }, duration);
          }

          function removeToast(el) {
            el.classList.add('removing');
            setTimeout(function() {
              el.remove();
            }, 300);
          }
        }

        // ============ VALIDACI√ìN DEL FORMULARIO ==============
        var form = document.getElementById('lwf-form');
        if (!form) return;

        function normalizePhone(v) {
          return (v || '').toString().replace(/[^0-9]/g, '');
        }

        function validateEmail(email) {
          var re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return re.test(email);
        }

        function validatePhone(phone) {
          var normalized = normalizePhone(phone);
          return normalized.length === 9; // exactamente 9 d√≠gitos
        }

        function validateTextOnly(text) {
          // Solo letras, espacios y acentos
          var re = /^[a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]+$/;
          return re.test(text.trim());
        }

        function clearErrors() {
          form.querySelectorAll('.lwf-input, .lwf-select, .lwf-textarea').forEach(function(el) {
            el.classList.remove('error', 'success');
          });
          form.querySelectorAll('.lwf-error').forEach(function(el) {
            el.textContent = '';
          });
        }

        function showError(fieldId, message) {
          var field = document.getElementById(fieldId);
          var errorDiv = document.getElementById(fieldId + '-error');
          if (field) {
            field.classList.add('error');
            field.classList.remove('success');
          }
          if (errorDiv) {
            errorDiv.textContent = message;
          }
        }

        function showSuccess(fieldId) {
          var field = document.getElementById(fieldId);
          if (field) {
            field.classList.remove('error');
            field.classList.add('success');
          }
        }

        function validateForm() {
          clearErrors();
          var isValid = true;

          // Validar nombre
          var nombre = document.getElementById('lwf-nombre').value.trim();
          if (!nombre) {
            showError('lwf-nombre', 'El nombre es requerido');
            isValid = false;
          } else if (!validateTextOnly(nombre)) {
            showError('lwf-nombre', 'El nombre solo debe contener letras y espacios');
            isValid = false;
          } else {
            showSuccess('lwf-nombre');
          }

          // Validar apellido
          var apellido = document.getElementById('lwf-apellido').value.trim();
          if (!apellido) {
            showError('lwf-apellido', 'El apellido es requerido');
            isValid = false;
          } else if (!validateTextOnly(apellido)) {
            showError('lwf-apellido', 'El apellido solo debe contener letras y espacios');
            isValid = false;
          } else {
            showSuccess('lwf-apellido');
          }

          // Validar email
          var email = document.getElementById('lwf-email').value.trim();
          if (!email) {
            showError('lwf-email', 'El email es requerido');
            isValid = false;
          } else if (!validateEmail(email)) {
            showError('lwf-email', 'El email no es v√°lido');
            isValid = false;
          } else {
            showSuccess('lwf-email');
          }

          // Validar tel√©fono
          var telefono = document.getElementById('lwf-telefono').value.trim();
          if (!telefono) {
            showError('lwf-telefono', 'El tel√©fono es requerido');
            isValid = false;
          } else if (!validatePhone(telefono)) {
            showError('lwf-telefono', 'El tel√©fono debe tener exactamente 9 d√≠gitos');
            isValid = false;
          } else {
            showSuccess('lwf-telefono');
          }

          // Validar inter√©s
          var interesEl = form.querySelector('input[name="interes"]:checked');
          if (!interesEl) {
            showError('lwf-interes', 'Selecciona al menos un inter√©s');
            isValid = false;
          }

          return isValid;
        }

        // ============ EVENTO DE CAMBIO EN CAMPOS ==============
        // Nombre: Solo letras y espacios
        var nombreInput = document.getElementById('lwf-nombre');
        if (nombreInput) {
          nombreInput.addEventListener('input', function(e) {
            var value = this.value;
            // Remover caracteres no v√°lidos
            var cleaned = value.replace(/[^a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]/g, '');
            if (cleaned !== value) {
              this.value = cleaned;
            }
          });
          nombreInput.addEventListener('blur', function() {
            if (this.value.trim() && validateTextOnly(this.value.trim())) {
              showSuccess('lwf-nombre');
            }
          });
        }

        // Apellido: Solo letras y espacios
        var apellidoInput = document.getElementById('lwf-apellido');
        if (apellidoInput) {
          apellidoInput.addEventListener('input', function(e) {
            var value = this.value;
            // Remover caracteres no v√°lidos
            var cleaned = value.replace(/[^a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]/g, '');
            if (cleaned !== value) {
              this.value = cleaned;
            }
          });
          apellidoInput.addEventListener('blur', function() {
            if (this.value.trim() && validateTextOnly(this.value.trim())) {
              showSuccess('lwf-apellido');
            }
          });
        }

        // Email: Validaci√≥n est√°ndar
        var emailInput = document.getElementById('lwf-email');
        if (emailInput) {
          emailInput.addEventListener('blur', function() {
            if (this.value.trim() && validateEmail(this.value.trim())) {
              showSuccess('lwf-email');
            }
          });
        }

        // Tel√©fono: Solo n√∫meros, m√°ximo 9
        var telefonoInput = document.getElementById('lwf-telefono');
        if (telefonoInput) {
          telefonoInput.addEventListener('input', function(e) {
            var value = this.value;
            // Remover caracteres no num√©ricos
            var cleaned = value.replace(/[^0-9]/g, '');
            // Limitar a 9 d√≠gitos
            if (cleaned.length > 9) {
              cleaned = cleaned.substring(0, 9);
            }
            // Actualizar el valor si cambi√≥
            this.value = cleaned;
          });
          telefonoInput.addEventListener('keypress', function(e) {
            // Rechazar si no es n√∫mero
            var char = String.fromCharCode(e.which);
            if (!/[0-9]/.test(char)) {
              e.preventDefault();
            }
          });
          telefonoInput.addEventListener('blur', function() {
            if (this.value.trim() && validatePhone(this.value.trim())) {
              showSuccess('lwf-telefono');
            }
          });
        }

        // ============ PROCESAMIENTO DEL FORMULARIO ==============
        var CRM_API_BASE = (window.CRM_API_BASE || 'http://localhost:5000/api');
        var submitButton = document.getElementById('lwf-submit-btn');
        var originalButtonText = submitButton ? submitButton.textContent : 'Contactar';

        form.addEventListener('submit', async function(e) {
          e.preventDefault();

          // Validar formulario
          if (!validateForm()) {
            showToast('Por favor completa todos los campos correctamente', 'error');
            return;
          }

          var nombre = document.getElementById('lwf-nombre').value.trim();
          var apellido = document.getElementById('lwf-apellido').value.trim();
          var email = document.getElementById('lwf-email').value.trim();
          var telefono = normalizePhone(document.getElementById('lwf-telefono').value);
          var interesEl = form.querySelector('input[name="interes"]:checked');
          var interes = interesEl ? interesEl.value : '';
          var origen = document.getElementById('lwf-origen').value || 'Web';
          var mensaje = document.getElementById('lwf-mensaje').value.trim();

          // Deshabilitar bot√≥n durante el env√≠o
          if (submitButton) {
            submitButton.disabled = true;
            submitButton.innerHTML = '<span class="lwf-spinner"></span> Enviando...';
          }

          var leadGuardado = false;
          var leadId = null;

          // PASO 1: Guardar en el CRM como Lead
          try {
            const crmUrl = CRM_API_BASE.replace(/\/$/, '') + '/public/lead';
            console.log('üì§ Enviando lead a CRM:', crmUrl);
            
            const controller = new AbortController();
            const timeout = setTimeout(() => controller.abort(), 8000);

            const response = await fetch(crmUrl, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                nombre: nombre,
                apellido: apellido,
                email: email,
                telefono: telefono,
                interes: interes,
                origen: origen || 'P√°gina Web',
                mensaje: mensaje
              }),
              signal: controller.signal
            });

            clearTimeout(timeout);

            if (!response.ok) {
              throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            
            if (data.exito) {
              console.log('‚úÖ Lead guardado en CRM:', data);
              leadGuardado = true;
              leadId = data.contacto?.id;
              showToast(`‚úì Lead guardado en el CRM exitosamente`, 'success', 4000);
            } else {
              console.warn('‚ö†Ô∏è Error en respuesta del CRM:', data.mensaje);
              showToast(`‚ö†Ô∏è ${data.mensaje || 'Error al guardar en CRM'}. Continuando con WhatsApp...`, 'warning', 4000);
            }
          } catch (error) {
            console.warn('‚ö†Ô∏è No se pudo guardar en CRM:', error.message);
            var warningMsg = 'No se pudo guardar en el CRM. Continuando...';
            if (error.name === 'AbortError') {
              warningMsg += ' (timeout)';
              console.warn('‚è±Ô∏è Timeout al conectar con CRM');
            } else if (error.message.includes('Failed to fetch')) {
              warningMsg += ' (sin conexi√≥n)';
              console.warn('üîå Problema de conexi√≥n de red');
            }
            showToast(warningMsg, 'warning', 3000);
          }

          // PASO 2: Abrir WhatsApp (siempre, como fallback)
          setTimeout(function() {
            try {
              var waNumber = '51948734448'; // N√∫mero configurado

              var lines = [
                'üè† *Hola, deseo m√°s informaci√≥n sobre propiedades*',
                '',
                'üë§ *Datos del interesado:*',
                'üìõ *Nombre:* ' + nombre + ' ' + apellido,
                'üìß *Email:* ' + email,
                'üì± *Tel√©fono:* +51' + telefono,
                'üéØ *Inter√©s:* ' + interes
              ];
              
              if (origen && origen !== 'Web') {
                lines.push('üìç *Origen:* ' + origen);
              }
              
              if (mensaje) {
                lines.push('');
                lines.push('üí¨ *Mensaje:* ' + mensaje);
              }

              lines.push('');
              lines.push('---');
              lines.push('‚è∞ *Enviado desde:* ' + new Date().toLocaleString('es-PE'));

              var text = encodeURIComponent(lines.join('\n'));
              var whatsappUrl = 'https://wa.me/' + waNumber + '?text=' + text;
              
              console.log('üì± Abriendo WhatsApp...');
              window.open(whatsappUrl, '_blank');
              showToast('‚úì Se abri√≥ WhatsApp. Env√≠a el mensaje para contactar al asesor', 'success', 5000);

            } catch (waError) {
              console.error('Error al abrir WhatsApp:', waError);
              showToast('Error al abrir WhatsApp', 'error', 3000);
            }

            // Limpiar y resetear formulario
            setTimeout(function() {
              form.reset();
              clearErrors();
              
              if (submitButton) {
                submitButton.disabled = false;
                submitButton.innerHTML = originalButtonText;
              }

              // Scroll al inicio del formulario
              document.getElementById('lead-whatsapp').scrollIntoView({ behavior: 'smooth' });
              showToast('‚úì Formulario listo para nuevo env√≠o', 'info', 3000);
            }, 1500);

          }, 800); // Peque√±o delay para mejor UX
        });
      })();
    </script>
    <!-- Scripts -->
    <script src="js/main.js"></script>
    <script src="js/testimonios-carousel.js"></script>
</body>
</html>
